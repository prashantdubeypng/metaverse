<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåå Space Membership Test UI - Production Ready</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        .user-selection {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .user-card {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 200px;
        }
        .user-card:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        .user-card.active {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.3);
        }
        .user-info h3 {
            margin: 0 0 5px 0;
            color: #ffffff;
        }
        .user-info p {
            margin: 0;
            font-size: 14px;
            opacity: 0.8;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            box-sizing: border-box;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: background 0.3s;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid #4CAF50;
        }
        .status.error {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
        }
        .status.info {
            background: rgba(33, 150, 243, 0.2);
            border: 1px solid #2196F3;
        }
        .logs {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .split-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .chatroom-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid transparent;
        }
        .chatroom-item.public {
            border-left-color: #4CAF50;
        }
        .chatroom-item.private {
            border-left-color: #ff9800;
        }
        .chatroom-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .chatroom-name {
            font-weight: bold;
            font-size: 16px;
        }
        .chatroom-type {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            text-transform: uppercase;
        }
        .connection-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #f44336;
            display: inline-block;
            margin-left: 10px;
        }
        .connection-indicator.connected {
            background: #4CAF50;
        }
        @media (max-width: 768px) {
            .split-container {
                grid-template-columns: 1fr;
            }
            .user-selection {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <h1>üè¢ Space Membership Chat System Test</h1>
    
    <div class="container">
        <h2>üë• Select User to Test</h2>
        <div class="user-selection">
            <div class="user-card" data-user="demo-user-ram">
                <div class="user-info">
                    <h3>Ram (Space Admin)</h3>
                    <p>‚Ä¢ Creator & Admin of "Ram's Office Space"</p>
                    <p>‚Ä¢ Can create public/private chatrooms</p>
                    <p>‚Ä¢ Full access to all features</p>
                </div>
            </div>
            <div class="user-card" data-user="demo-user-shyam">
                <div class="user-info">
                    <h3>Shyam (Space Member)</h3>
                    <p>‚Ä¢ Member of "Ram's Office Space"</p>
                    <p>‚Ä¢ Can create public/private chatrooms</p>
                    <p>‚Ä¢ Can join public rooms, needs approval for private</p>
                </div>
            </div>
            <div class="user-card" data-user="demo-user-rohan">
                <div class="user-info">
                    <h3>Rohan (Space Member)</h3>
                    <p>‚Ä¢ Member of "Ram's Office Space"</p>
                    <p>‚Ä¢ Can create public/private chatrooms</p>
                    <p>‚Ä¢ Can join public rooms, needs approval for private</p>
                </div>
            </div>
        </div>
        
        <div id="connectionStatus" class="status info">
            Select a user and click Connect
            <span class="connection-indicator" id="connectionIndicator"></span>
        </div>
        
        <button onclick="connect()">Connect to Chat Service</button>
        <button onclick="disconnect()">Disconnect</button>
        <button onclick="clearLogs()">Clear Logs</button>
    </div>

    <div class="split-container">
        <div class="container">
            <h2>üèóÔ∏è Create New Chatroom</h2>
            <div class="form-group">
                <label>Space ID:</label>
                <input type="text" id="spaceId" value="demo-space-ram" readonly>
            </div>
            <div class="form-group">
                <label>Chatroom Name:</label>
                <input type="text" id="chatroomName" placeholder="Enter chatroom name">
            </div>
            <div class="form-group">
                <label>Description:</label>
                <textarea id="chatroomDescription" placeholder="Enter description (optional)" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label>Privacy:</label>
                <select id="chatroomPrivacy">
                    <option value="false">Public (Anyone in space can join)</option>
                    <option value="true">Private (Approval required)</option>
                </select>
            </div>
            <button onclick="createChatroom()">Create Chatroom</button>
            
            <h3>üìã Test Scenarios</h3>
            <button onclick="testScenario('public-general')">Create Public "General Discussion"</button>
            <button onclick="testScenario('private-management')">Create Private "Management Team"</button>
            <button onclick="testScenario('public-random')">Create Public "Random Chat"</button>
        </div>

        <div class="container">
            <h2>üí¨ Available Chatrooms</h2>
            <div id="chatroomsList">
                <div class="chatroom-item public">
                    <div class="chatroom-header">
                        <div class="chatroom-name">General Discussion</div>
                        <div class="chatroom-type">Public</div>
                    </div>
                    <p>Public chatroom for general discussions (Created by Shyam)</p>
                    <button onclick="joinRoom('demo-chatroom-public')">Join Room</button>
                </div>
                
                <div class="chatroom-item private">
                    <div class="chatroom-header">
                        <div class="chatroom-name">Management Discussion</div>
                        <div class="chatroom-type">Private</div>
                    </div>
                    <p>Private chatroom for management team (Created by Ram)</p>
                    <button onclick="joinRoom('demo-chatroom-private')">Join Room</button>
                </div>
            </div>
            
            <h3>üß™ Join Test Scenarios</h3>
            <button onclick="testJoinScenario('public')">Test Public Room Access</button>
            <button onclick="testJoinScenario('private')">Test Private Room Access</button>
        </div>
    </div>

    <div class="container">
        <h2>üìä Activity Logs</h2>
        <div id="logs" class="logs">Welcome to Space Membership Chat Test
Ready to test space-based chatroom permissions...

Demo Setup:
‚Ä¢ Ram's Office Space (demo-space-ram)
  - Ram: Admin (can create chatrooms)
  - Shyam: Member (can create chatrooms)  
  - Rohan: Member (can create chatrooms)

‚Ä¢ Existing Chatrooms:
  - General Discussion (Public, by Shyam)
  - Management Discussion (Private, by Ram)

Test different users to verify space membership permissions!
</div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        let socket = null;
        let currentUser = null;
        let isConnected = false;

        // User data mapping
        const users = {
            'demo-user-ram': { username: 'Ram', password: 'password123' },
            'demo-user-shyam': { username: 'Shyam', password: 'password123' },
            'demo-user-rohan': { username: 'Rohan', password: 'password123' }
        };

        // User selection
        document.querySelectorAll('.user-card').forEach(card => {
            card.addEventListener('click', () => {
                // Remove active class from all cards
                document.querySelectorAll('.user-card').forEach(c => c.classList.remove('active'));
                // Add active class to clicked card
                card.classList.add('active');
                // Set current user
                currentUser = card.dataset.user;
                log(`üë§ Selected user: ${users[currentUser].username} (${currentUser})`);
                updateConnectionStatus(`Selected: ${users[currentUser].username}`, 'info');
            });
        });

        function log(message) {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logs.textContent += `[${timestamp}] ${message}\n`;
            logs.scrollTop = logs.scrollHeight;
        }

        function updateConnectionStatus(message, type) {
            const status = document.getElementById('connectionStatus');
            const indicator = document.getElementById('connectionIndicator');
            status.textContent = message;
            status.className = `status ${type}`;
            
            if (type === 'success') {
                indicator.classList.add('connected');
            } else {
                indicator.classList.remove('connected');
            }
        }

        function connect() {
            if (!currentUser) {
                log('‚ùå Please select a user first');
                return;
            }

            if (isConnected) {
                log('‚ö†Ô∏è Already connected');
                return;
            }

            log(`üîå Connecting as ${users[currentUser].username}...`);
            updateConnectionStatus('Connecting...', 'info');

            // Create socket connection with auth
            socket = io('http://localhost:8002', {
                auth: {
                    userId: currentUser,
                    username: users[currentUser].username,
                    password: users[currentUser].password
                },
                transports: ['websocket', 'polling']
            });

            // Connection events
            socket.on('connect', () => {
                isConnected = true;
                log(`‚úÖ Connected as ${users[currentUser].username}`);
                updateConnectionStatus(`Connected as ${users[currentUser].username}`, 'success');
            });

            socket.on('disconnect', (reason) => {
                isConnected = false;
                log(`‚ùå Disconnected: ${reason}`);
                updateConnectionStatus('Disconnected', 'error');
            });

            socket.on('connect_error', (error) => {
                log(`‚ùå Connection error: ${error.message}`);
                updateConnectionStatus('Connection failed', 'error');
            });

            // Chat events
            socket.on('chatroom-created', (data) => {
                log(`‚úÖ Chatroom created successfully:`);
                log(`   üìù Name: ${data.name}`);
                log(`   üîí Privacy: ${data.isPrivate ? 'Private' : 'Public'}`);
                log(`   üÜî ID: ${data.id}`);
                log(`   üè¢ Space: ${data.spaceId}`);
            });

            socket.on('room-joined', (data) => {
                log(`‚úÖ Successfully joined room:`);
                log(`   üìù Name: ${data.roomName}`);
                log(`   üÜî ID: ${data.roomId}`);
                log(`   üë• Members: ${data.memberCount}`);
            });

            socket.on('join-request-sent', (data) => {
                log(`üì® Join request sent for private room: ${data.roomId}`);
                log(`   üí¨ ${data.message}`);
            });

            socket.on('error', (error) => {
                log(`‚ùå Error: ${error.message}`);
            });

            socket.on('user-joined', (data) => {
                log(`üë§ ${data.username} joined the room`);
            });

            socket.on('receive-message', (data) => {
                log(`üí¨ ${data.username}: ${data.message}`);
            });
        }

        function disconnect() {
            if (socket && isConnected) {
                socket.disconnect();
                socket = null;
                isConnected = false;
                log('üîå Manually disconnected');
                updateConnectionStatus('Disconnected', 'info');
            }
        }

        function createChatroom() {
            if (!isConnected) {
                log('‚ùå Please connect first');
                return;
            }

            const spaceId = document.getElementById('spaceId').value;
            const name = document.getElementById('chatroomName').value.trim();
            const description = document.getElementById('chatroomDescription').value.trim();
            const isPrivate = document.getElementById('chatroomPrivacy').value === 'true';

            if (!name) {
                log('‚ùå Please enter a chatroom name');
                return;
            }

            log(`üèóÔ∏è Creating ${isPrivate ? 'PRIVATE' : 'PUBLIC'} chatroom "${name}"...`);
            log(`   üè¢ Space: ${spaceId}`);
            log(`   üë§ Creator: ${users[currentUser].username}`);

            socket.emit('create-chatroom', {
                spaceId: spaceId,
                name: name,
                description: description || undefined,
                isPrivate: isPrivate
            });
        }

        function testScenario(scenario) {
            const scenarios = {
                'public-general': {
                    name: 'General Discussion',
                    description: 'Public chatroom for general discussions',
                    isPrivate: false
                },
                'private-management': {
                    name: 'Management Team',
                    description: 'Private chatroom for management discussions',
                    isPrivate: true
                },
                'public-random': {
                    name: 'Random Chat',
                    description: 'Casual conversations and random topics',
                    isPrivate: false
                }
            };

            const config = scenarios[scenario];
            if (!config) return;

            document.getElementById('chatroomName').value = config.name;
            document.getElementById('chatroomDescription').value = config.description;
            document.getElementById('chatroomPrivacy').value = config.isPrivate.toString();

            log(`üß™ Test scenario loaded: ${config.name} (${config.isPrivate ? 'Private' : 'Public'})`);
        }

        function joinRoom(roomId) {
            if (!isConnected) {
                log('‚ùå Please connect first');
                return;
            }

            log(`üö™ Attempting to join room: ${roomId}`);
            log(`   üë§ User: ${users[currentUser].username}`);
            
            socket.emit('join-room', roomId);
        }

        function testJoinScenario(type) {
            if (type === 'public') {
                log('üß™ Testing public room access...');
                joinRoom('demo-chatroom-public');
            } else if (type === 'private') {
                log('üß™ Testing private room access...');
                joinRoom('demo-chatroom-private');
            }
        }

        function clearLogs() {
            document.getElementById('logs').textContent = 'Logs cleared...\n';
        }

        // Auto-select Ram as default
        document.querySelector('[data-user="demo-user-ram"]').click();
    </script>
</body>
</html>
